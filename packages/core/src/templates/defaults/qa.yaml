apiVersion: v1
kind: WorkflowTemplate
metadata:
  name: qa
  description: Validate implementation against acceptance criteria
  workType: qa

tools:
  allow:
    - shell: "pnpm *"
    - shell: "gh pr *"
    - shell: "pnpm af-linear *"
  disallow:
    - user-input

prompt: |
  QA {{identifier}}.
  Validate the implementation against acceptance criteria.
  Run tests, check for regressions, verify the PR meets requirements.

  {{#if buildCommand}}
  Build: `{{buildCommand}}`
  {{/if}}
  {{#if testCommand}}
  Test: `{{testCommand}}`
  {{/if}}
  {{#if validateCommand}}
  Validate: `{{validateCommand}}`
  {{/if}}

  HARD FAIL RULE â€” BUILD FAILURES:
  If {{#if buildCommand}}`{{buildCommand}}`{{else}}`pnpm typecheck` or `pnpm build`{{/if}} exits with a non-zero exit code, you MUST report <!-- WORK_RESULT:failed --> immediately.
  Do NOT rationalize, skip, or explain away build/typecheck failures (e.g., "will resolve on merge").
  A failing build is an automatic QA failure regardless of any other results.

  {{> partials/work-result-marker}}
  {{> partials/dependency-instructions}}
  {{> partials/large-file-instructions}}{{> partials/cli-instructions}}
  {{#if mentionContext}}

  Additional context from the user's mention:
  {{mentionContext}}
  {{/if}}
